{
  "packageName" : "DEMO_UNLOAD_SF",
  "packageVersion" : "1001256",
  "templateVersion" : "2.11",
  "dataPackage" : {
    "packageId" : "bfec64c8-db07-4008-8733-453e735948d7",
    "packageName" : "DEMO_UNLOAD_SF",
    "packageVersion" : "1001256",
    "createdUser" : "henri.hemminki@solita.fi",
    "packageStatus" : "COMMITTED",
    "createdTimestamp" : 1686056406557,
    "modifiedTimestamp" : 1686117044989,
    "modifiedUser" : "henri.hemminki@solita.fi",
    "statusChangedTimestamp" : 1686056406553,
    "statusChangedUser" : "henri.hemminki@solita.fi",
    "deleted" : false,
    "description" : "#DEMO",
    "packageType" : "ENTITY_PACKAGE"
  },
  "packageDependencies" : [ ],
  "entities" : [ {
    "entityId" : "6699e58c-1599-46ea-b3a8-b805e66ddcde",
    "packageId" : "bfec64c8-db07-4008-8733-453e735948d7",
    "owner" : "publish",
    "entityName" : "F_SALES",
    "entityLogicalName" : "SALES",
    "zone" : "INFORMATION_DELIVERY",
    "entityType" : "FACT",
    "physicalType" : "TABLE",
    "modifiedTimestamp" : 1686117039007,
    "modifiedUser" : "henri.hemminki@solita.fi",
    "isDeleted" : false,
    "isRecreateForced" : false,
    "isAutomaticallyManaged" : false
  } ],
  "attributes" : [ {
    "attributeId" : "029fbab1-5e98-4da9-ae3a-381fb6547a74",
    "entityId" : "6699e58c-1599-46ea-b3a8-b805e66ddcde",
    "attributeName" : "sales_id",
    "position" : 1,
    "datatype" : "INTEGER8",
    "isPersistent" : true,
    "isCharUsed" : false,
    "charLength" : 0,
    "isNullable" : true,
    "isDeleted" : false
  }, {
    "attributeId" : "94664582-0234-4124-9c7e-0cc56ec6a8e8",
    "entityId" : "6699e58c-1599-46ea-b3a8-b805e66ddcde",
    "attributeName" : "date",
    "position" : 2,
    "datatype" : "DATE",
    "isPersistent" : true,
    "isCharUsed" : false,
    "charLength" : 0,
    "isNullable" : true,
    "isDeleted" : false
  }, {
    "attributeId" : "f78aa882-ca5d-4188-a177-504260fd3ff6",
    "entityId" : "6699e58c-1599-46ea-b3a8-b805e66ddcde",
    "attributeName" : "product_id",
    "position" : 3,
    "datatype" : "INTEGER8",
    "isPersistent" : true,
    "isCharUsed" : false,
    "charLength" : 0,
    "isNullable" : true,
    "isDeleted" : false
  }, {
    "attributeId" : "a5ce9013-ec46-493e-8e15-0f0e93be38c2",
    "entityId" : "6699e58c-1599-46ea-b3a8-b805e66ddcde",
    "attributeName" : "quantity",
    "position" : 4,
    "datatype" : "INTEGER8",
    "isPersistent" : true,
    "isCharUsed" : false,
    "charLength" : 0,
    "isNullable" : true,
    "isDeleted" : false
  }, {
    "attributeId" : "e585bea2-5dbd-48f7-82ff-d1e64fc5b8dd",
    "entityId" : "6699e58c-1599-46ea-b3a8-b805e66ddcde",
    "attributeName" : "price",
    "position" : 5,
    "datatype" : "DOUBLE",
    "isPersistent" : true,
    "isCharUsed" : false,
    "charLength" : 0,
    "isNullable" : true,
    "isDeleted" : false
  } ],
  "referenceKeys" : [ ],
  "referenceKeyAttributes" : [ ],
  "keys" : [ ],
  "keyAttributes" : [ ],
  "mappingEntities" : [ {
    "mappingEntitiesId" : "a6596416-7a37-4e06-b0bb-f089de1181bd",
    "mappingName" : "TEMPORARY_MAPPINGb496bd5d-6753-4aa7-b7f6-be2a510abe7a",
    "mappingType" : "SOURCE",
    "targetEntityId" : "6699e58c-1599-46ea-b3a8-b805e66ddcde",
    "entityLoadId" : "f9421df2-41f6-4eec-8fc9-41bd064631af",
    "position" : 1
  } ],
  "mappingSourceAttributes" : [ ],
  "mappingTargetAttributes" : [ ],
  "entityLoads" : [ {
    "entityLoadId" : "f9421df2-41f6-4eec-8fc9-41bd064631af",
    "targetEntityId" : "6699e58c-1599-46ea-b3a8-b805e66ddcde",
    "loadName" : "load_f_sales_from_source_entity_01",
    "entityLoadType" : "TRANSFORM_PERSIST",
    "schedulingId" : "72baef04098f035e8a320b03ad197818",
    "customSchedulingName" : "DEMO_SCHEDULE",
    "enabled" : true
  } ],
  "entityLoadSteps" : [ {
    "entityLoadStepId" : "51d09885-12c5-41f1-98bd-0341f1d777bc",
    "entityLoadId" : "f9421df2-41f6-4eec-8fc9-41bd064631af",
    "loadStepName" : "truncate",
    "position" : 1,
    "loadLanguageName" : "SQL",
    "stepType" : "PRE",
    "readAffectedRows" : false,
    "loadLanguageDescription" : "Run custom SQL logic.",
    "textStep" : "truncate table <target_schema>.<target_entity_name>"
  }, {
    "entityLoadStepId" : "ea37c419-35f8-44f1-afd4-6ab284947a13",
    "entityLoadId" : "f9421df2-41f6-4eec-8fc9-41bd064631af",
    "loadStepName" : "insert",
    "position" : 2,
    "loadLanguageName" : "SQL",
    "stepType" : "OVERRIDE",
    "readAffectedRows" : false,
    "loadLanguageDescription" : "Run custom SQL logic.",
    "textStep" : "INSERT INTO <target_schema>.<target_entity_name> (sales_id, date, product_id, quantity, price)\nVALUES \n    (1, '2023-06-01', 101, 5, 10.00),\n    (2, '2023-06-02', 102, 3, 15.00),\n    (3, '2023-06-03', 103, 2, 20.00),\n    (4, '2023-06-03', 104, 4, 8.00),\n    (5, '2023-06-04', 105, 7, 5.00);"
  }, {
    "entityLoadStepId" : "6b791b38-3360-4bbc-b456-5666f5969c03",
    "entityLoadId" : "f9421df2-41f6-4eec-8fc9-41bd064631af",
    "loadStepName" : "create_procedure",
    "position" : 3,
    "loadLanguageName" : "SQL",
    "stepType" : "OVERRIDE",
    "readAffectedRows" : false,
    "loadLanguageDescription" : "Run custom SQL logic.",
    "textStep" : "CREATE OR REPLACE PROCEDURE <target_schema>.copy_data_to_cloud_storage()\nRETURNS TABLE()\nLANGUAGE SQL\nEXECUTE AS CALLER\nAS \n$$\n     DECLARE\n        partition VARCHAR;\n        stage VARCHAR;\n        unload_command VARCHAR;\n        full_path VARCHAR;\n        entity VARCHAR;\n        timemillis INTEGER;\n        file_name VARCHAR;\n        rs RESULTSET;\n     BEGIN\n        partition := (SELECT TO_CHAR(CURRENT_DATE, 'YYYY/MM/DD'));\n        stage := '<stage_name>';\n        entity := (SELECT lower('<target_entity_name>'));\n        full_path := stage::VARCHAR || '/' || entity || '/' || partition::VARCHAR || '/';\n        timemillis := (SELECT date_part(EPOCH_MILLISECOND, current_timestamp));\n        file_name := entity || '_' || timemillis || '.csv.gz';\n        unload_command := 'copy into ' || full_path::VARCHAR || file_name || ' ' ||\n                          'from (select * from <target_schema>.<target_entity_name>) file_format = ' ||\n                          '(type = csv compression = \\'gzip\\' record_delimiter = \\'\\\\n\\' field_delimiter = \\'|\\' ' ||\n                          'field_optionally_enclosed_by = \\'\\\"\\' null_if = \\'\\') ' ||\n                          'overwrite = false single = true header = true;';\n        rs := (EXECUTE IMMEDIATE :unload_command);\n        RETURN TABLE(rs);\n     END;\n$$;"
  }, {
    "entityLoadStepId" : "e8aab8bf-773a-45ab-81a1-3388da0a15c8",
    "entityLoadId" : "f9421df2-41f6-4eec-8fc9-41bd064631af",
    "loadStepName" : "call_procedure",
    "position" : 4,
    "loadLanguageName" : "SQL",
    "stepType" : "OVERRIDE",
    "readAffectedRows" : false,
    "loadLanguageDescription" : "Run custom SQL logic.",
    "textStep" : "CALL <target_schema>.copy_data_to_cloud_storage();"
  } ],
  "entityLoadOpts" : [ ],
  "entityLoadFiles" : [ ],
  "entityRelationships" : [ ],
  "grants" : [ ],
  "entityPhysicalOpts" : [ {
    "physicalOptId" : "fce10f3f-b293-460f-a62f-bc53a2c5a0fa",
    "entityId" : "6699e58c-1599-46ea-b3a8-b805e66ddcde",
    "value" : "true",
    "physicalOptType" : "STORAGE.TRANSIENT_TABLE"
  } ]
}